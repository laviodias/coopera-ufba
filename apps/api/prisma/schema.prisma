// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String          @id @default(uuid())
  email       String          @unique
  name        String
  img         String?
  password    String
  role        UserRole        @default(USER)
  status   UserStatus         @default(PENDING)     
  resetToken  String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  company     Company?
  researcher  Researcher?
}

enum UserRole {
  USER
  ADMIN
}

enum UserStatus {
  APPROVED
  BLOCK
  PENDING
}

model Keyword {
  id        String    @id @default(uuid())
  name      String
  projects  Project[]
  demands   Demand[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Company {
  user         User     @relation(fields: [userId], references: [id])
  userId       String   @id
  contactName  String?
  contactEmail String?
  contactPhone String?
  demands      Demand[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Researcher {
  user                   User            @relation(fields: [userId], references: [id])
  userId                 String          @id
  urlLattes              String?
  researcherType         ResearcherType  @default(TEACHER)
  researchGroupsAsLeader ResearchGroup[] @relation("ResearchGroupLeader")
  researchGroupsAsMember ResearchGroup[] @relation("ResearchGroupMembers")
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
}

enum ResearcherType {
  STUDENT
  TEACHER
}

model ResearchGroup {
  id             String          @id @default(uuid())
  name           String          @unique
  description    String
  urlCNPQ        String?
  img            String?
  leader         Researcher      @relation(fields: [researcherId], references: [userId], name: "ResearchGroupLeader")
  researcherId   String
  knowledgeAreas KnowledgeArea[]
  members        Researcher[]    @relation("ResearchGroupMembers")
  projects       Project[]
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  Notifications  Notification[]
}

model KnowledgeArea {
  id                   String          @id @default(uuid())
  name                 String
  researchGroupsOfArea ResearchGroup[]
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
}

model Project {
  id              String        @id @default(uuid())
  name            String        @unique
  started_at      DateTime
  finished_at     DateTime?
  researchGroup   ResearchGroup @relation(fields: [researchGroupId], references: [id])
  researchGroupId String
  demand          Demand?       @relation(fields: [demandId], references: [id])
  demandId        String?
  keywords        Keyword[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model Demand {
  id            String         @id @default(uuid())
  name          String
  company       Company        @relation(fields: [companyId], references: [userId])
  description   String
  companyId     String
  status        String         @default("CREATED")
  public        Boolean        @default(true)
  projects      Project[]
  keywords      Keyword[]
  notifications Notification[]
  attachments   Attachment[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Notification {
  id              String                @id @default(uuid())
  message         String
  demand          Demand                @relation(fields: [demandId], references: [id])
  demandId        String
  researchGroup   ResearchGroup         @relation(fields: [researchGroupId], references: [id])
  researchGroupId String
  started_by      NotificationStartedBy
  createdAt       DateTime              @default(now())
}

enum NotificationStartedBy {
  RESEARCHGROUP
  COMPANY
}

model Attachment {
  id        String   @id @default(uuid())
  url       String
  demand    Demand   @relation(fields: [demandId], references: [id])
  demandId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
